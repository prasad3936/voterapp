<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ title if title else "Voter Information System" }}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- ‚úÖ Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <!-- ‚úÖ Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      html,
      body {
        margin: 0;
        background: #f4f8ff;
        font-family: Arial, sans-serif;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      /* Navbar */
      .navbar {
        background: #003366;
        padding: 10px 14px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .navbar a {
        color: white;
        margin-left: 12px;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
      }

      .navbar a:hover {
        text-decoration: underline;
      }

      /* Total Voter Badge */
      #voterCountBadge {
        background: linear-gradient(90deg, #007bff, #00b4ff);
        color: #fff;
        font-weight: 700;
        border-radius: 20px;
        padding: 6px 12px;
        margin-left: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }

      /* Auto translate toggle */
      .translator-switch {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: 10px;
        color: white;
        font-size: 14px;
      }
      .translator-switch input {
        transform: scale(1.2);
      }

      /* Lang buttons */
      .lang-btn {
        border: 1px solid #fff;
        color: #fff;
        background: transparent;
        padding: 3px 6px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 5px;
        transition: all 0.3s ease;
      }

      .lang-btn:hover {
        background: white;
        color: #003366;
      }

      footer {
        background: #002850;
        color: #fff;
        text-align: center;
        padding: 8px 0;
        font-size: 13px;
        margin-top: auto;
      }

      footer a {
        color: #00ffb3;
        text-decoration: none;
        font-weight: bold;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Hide Google UI */
      .goog-logo-link,
      .goog-te-gadget span,
      .goog-te-banner-frame,
      .goog-te-balloon-frame,
      .goog-te-spinner-pos,
      #goog-gt-tt {
        display: none !important;
      }
      .goog-te-gadget {
        font-size: 0 !important;
        color: transparent !important;
      }

      /* ‚úÖ Floating Contact Developer Button */
      .contact-dev-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #25d366;
        color: white;
        padding: 10px 16px;
        border-radius: 30px;
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        z-index: 9999;
        transition: 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .contact-dev-btn:hover {
        transform: scale(1.05);
        background: #22c15e;
      }

      @media (max-width: 768px) {
        .navbar {
          flex-direction: column;
          text-align: center;
          gap: 8px;
        }
      }
    </style>
  </head>

  <body>
    <!-- ‚úÖ Navbar -->
    <div class="navbar">
      <div class="navbar-title fw-bold">Voter Information System</div>

      {% if session.get('user') %}
      <div class="d-flex align-items-center flex-wrap">
        <a href="/dashboard">üè† Home</a>

        <!-- ‚úÖ Total Voters -->
        <span id="voterCountBadge">Total: {{ total_voters }}</span>

        <!-- Auto Translate -->
        <label class="translator-switch">
          <input id="translatorToggle" type="checkbox" />
          <small>Auto Translate</small>
        </label>

        <!-- Language Buttons -->
        <div id="langButtons" style="display: none">
          <button class="lang-btn" onclick="chooseLang('en')">üá¨üáß EN</button>
          <button class="lang-btn" onclick="chooseLang('mr')">üáÆüá≥ MR</button>
        </div>

        <!-- Logout -->
        <a href="/logout"><i class="fa-solid fa-door-open"></i> Logout</a>

        <span
          id="google_translate_element"
          style="visibility: hidden; height: 0"
        ></span>
      </div>
      {% endif %}
    </div>

    <!-- ‚úÖ Content Area -->
    <div class="content-wrapper container mt-2">
      {% block content %}{% endblock %}
    </div>

    <!-- ‚úÖ Floating Developer Contact -->
    <div
      class="contact-dev-btn"
      onclick="window.open('https://wa.me/919637370116?text=Hi%20Prasad%2C%20I%20need%20help%20with%20a%20web%20project!', '_blank')"
    >
      <i class="fa-brands fa-whatsapp"></i> Contact Developer
    </div>

    <!-- ‚úÖ Footer -->
    <footer>
      Copyright ¬© 2025 All Rights Reserved | üíª Developed by
      <strong>Prasad Zungare Patil</strong> |
      <a
        href="https://wa.me/919637370116?text=Hi%20Prasad%2C%20I%20want%20a%20website%20like%20voterapp!"
      >
        WhatsApp</a
      >
      üìû +91 9637370116
    </footer>

    <!-- ‚úÖ Translator Script -->
    <script>
      const GOOGLE_SCRIPT_SRC =
        "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
      let googleScriptEl = null;

      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en",
            includedLanguages: "en,mr",
            autoDisplay: false,
          },
          "google_translate_element"
        );
        const saved = localStorage.getItem("langChoice") || "en";
        setGoogleLang(saved);
      }

      function loadGoogleScript() {
        if (googleScriptEl) return;
        googleScriptEl = document.createElement("script");
        googleScriptEl.src = GOOGLE_SCRIPT_SRC;
        googleScriptEl.async = true;
        document.head.appendChild(googleScriptEl);
      }

      function setGoogleLang(lang) {
        const combo = document.querySelector(".goog-te-combo");
        if (!combo) return;
        combo.value = lang === "mr" ? "mr" : "en";
        combo.dispatchEvent(new Event("change"));
        localStorage.setItem("langChoice", lang);
      }

      function setTranslatorEnabled(enabled) {
        localStorage.setItem("translatorEnabled", enabled ? "1" : "0");
        document.getElementById("langButtons").style.display = enabled
          ? "inline-flex"
          : "none";
        if (enabled) {
          loadGoogleScript();
        } else {
          localStorage.setItem("langChoice", "en");
          location.reload();
        }
      }

      function chooseLang(lang) {
        if (localStorage.getItem("translatorEnabled") !== "1") {
          setTranslatorEnabled(true);
          setTimeout(() => setGoogleLang(lang), 1200);
        } else {
          setGoogleLang(lang);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const enabled = localStorage.getItem("translatorEnabled") === "1";
        document.getElementById("translatorToggle").checked = enabled;

        if (enabled) {
          loadGoogleScript();
          document.getElementById("langButtons").style.display = "inline-flex";
        }

        document
          .getElementById("translatorToggle")
          .addEventListener("change", (ev) => {
            setTranslatorEnabled(ev.target.checked);
          });
      });

      document.addEventListener("DOMContentLoaded", () => {
        if (window.location.pathname.startsWith("/voter/")) {
          const badge = document.getElementById("voterCountBadge");
          if (badge) badge.style.display = "none";
        }
      });
    </script>
  </body>
</html>
