<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ title if title else "Voter Information System" }}</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />

    <style>
      html,
      body {
        margin: 0;
        background: #f4f8ff;
        font-family: Arial;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      .navbar {
        background: #003366;
        padding: 12px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
      .navbar a {
        color: white;
        margin-left: 12px;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
      }
      .lang-btn {
        border: 1px solid #fff;
        color: #fff;
        background: transparent;
        padding: 3px 6px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 5px;
      }
      footer {
        background: #002850;
        color: #fff;
        text-align: center;
        padding: 8px 0;
        font-size: 13px;
        margin-top: auto;
      }

      /* Hide Google UI */
      .goog-logo-link,
      .goog-te-gadget span,
      .goog-te-banner-frame,
      .goog-te-balloon-frame,
      .goog-te-spinner-pos,
      #goog-gt-tt {
        display: none !important;
      }
      .goog-te-gadget {
        font-size: 0 !important;
        color: transparent !important;
      }
      body {
        top: 0 !important;
      }

      /* Voter badge */
      #voterCountBadge {
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 10px;
        background: #0d6efd;
        color: white;
        margin-left: 6px;
        font-weight: bold;
      }

      /* Auto translate toggle */
      .translator-switch {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: 10px;
        color: white;
      }
      .translator-switch input {
        transform: scale(1.1);
      }
    </style>
  </head>

  <body>
    <div class="navbar">
      <div class="navbar-title fw-bold">Voter Information System</div>

      {% if session.get('user') %}
      <div class="d-flex align-items-center">
        <a href="/dashboard">üè† Home</a>
        <span id="voterCountBadge">Total: {{ total_voters }}</span>

        <!-- Toggle -->
        <label class="translator-switch">
          <input id="translatorToggle" type="checkbox" />
          <small>Auto Translate</small>
        </label>

        <!-- Lang Buttons (Hidden initially) -->
        <div id="langButtons" style="display: none">
          <button class="lang-btn" onclick="chooseLang('en')">üá¨üáß EN</button>
          <button class="lang-btn" onclick="chooseLang('mr')">üáÆüá≥ MR</button>
        </div>

        <a href="/logout">üö™ Logout</a>

        <span
          id="google_translate_element"
          style="visibility: hidden; height: 0"
        ></span>
      </div>
      {% endif %}
    </div>

    <div class="content-wrapper container mt-2">
      {% block content %}{% endblock %}
    </div>

    <footer>¬© Invictus Technologies Pvt Ltd 2025</footer>

    <script>
      const GOOGLE_SCRIPT_SRC =
        "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
      let googleScriptEl = null;

      // ‚úÖ Google translate init
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en",
            includedLanguages: "en,mr",
            autoDisplay: false,
          },
          "google_translate_element"
        );
        const saved = localStorage.getItem("langChoice") || "en";
        setGoogleLang(saved);
      }

      // ‚úÖ Load Google script dynamically
      function loadGoogleScript() {
        if (googleScriptEl) return;
        googleScriptEl = document.createElement("script");
        googleScriptEl.src = GOOGLE_SCRIPT_SRC;
        googleScriptEl.async = true;
        document.head.appendChild(googleScriptEl);
      }

      // ‚úÖ Set language
      function setGoogleLang(lang) {
        const combo = document.querySelector(".goog-te-combo");
        if (!combo) return;
        combo.value = lang === "mr" ? "mr" : "en";
        combo.dispatchEvent(new Event("change"));
        localStorage.setItem("langChoice", lang);
      }

      // ‚úÖ Turn translator on/off
      function setTranslatorEnabled(enabled) {
        localStorage.setItem("translatorEnabled", enabled ? "1" : "0");

        // Show/Hide language buttons
        document.getElementById("langButtons").style.display = enabled
          ? "inline-flex"
          : "none";

        if (enabled) {
          loadGoogleScript();
        } else {
          localStorage.setItem("langChoice", "en");
          location.reload(); // remove translation
        }
      }

      // ‚úÖ EN/MR button clicked
      function chooseLang(lang) {
        if (localStorage.getItem("translatorEnabled") !== "1") {
          setTranslatorEnabled(true);
          setTimeout(() => setGoogleLang(lang), 1200);
        } else {
          setGoogleLang(lang);
        }
      }

      // ‚úÖ On page load
      document.addEventListener("DOMContentLoaded", () => {
        const enabled = localStorage.getItem("translatorEnabled") === "1";
        document.getElementById("translatorToggle").checked = enabled;

        if (enabled) {
          loadGoogleScript();
          document.getElementById("langButtons").style.display = "inline-flex";
        }

        document
          .getElementById("translatorToggle")
          .addEventListener("change", (ev) => {
            setTranslatorEnabled(ev.target.checked);
          });
      });
    </script>
  </body>
</html>
