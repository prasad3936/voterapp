{% extends "base.html" %} {% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  .card-border {
    border: 2px solid #000;
    padding: 10px;
    border-radius: 8px;
  }
  @media print {
    .no-print {
      display: none;
    }
    body * {
      visibility: hidden;
    }
    #vCard,
    #vCard * {
      visibility: visible;
    }
    #vCard {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
  }
  th {
    width: 40%;
  }
</style>

<div class="container mt-3" id="vCard">
  <div class="card card-border shadow" style="max-width: 420px; margin: auto">
    <h4 class="text-center fw-bold text-primary mt-2">‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§ì‡§≥‡§ñ‡§™‡§§‡•ç‡§∞</h4>

    <div class="text-center mb-2">
      <img
        src="/{{ v.photo if v.photo else 'static/photos/default.jpg' }}"
        width="130"
        height="150"
        class="img-thumbnail"
      />
    </div>

    <table class="table table-sm table-bordered">
      <tr>
        <th>‡§®‡§æ‡§µ</th>
        <td>{{ v.name }}</td>
      </tr>
      <tr>
        <th>‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
        <td>{{ v.serial }}</td>
      </tr>
      <tr>
        <th>EPIC</th>
        <td>{{ v.epic }}</td>
      </tr>
      <tr>
        <th>‡§®‡§æ‡§§‡•á‡§∏‡§Ç‡§¨‡§Ç‡§ß</th>
        <td>{{ v.relation }}</td>
      </tr>
      <tr>
        <th>‡§ò‡§∞ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
        <td>{{ v.house }}</td>
      </tr>
      <tr>
        <th>‡§µ‡§Ø</th>
        <td>{{ v.age }}</td>
      </tr>
      <tr>
        <th>‡§≤‡§ø‡§Ç‡§ó</th>
        <td>{{ v.gender }}</td>
      </tr>
    </table>
  </div>
</div>

<div class="container mt-3 no-print">
  <button class="btn btn-success w-100 mb-2" onclick="shareToWhatsapp()">
    üì≤ WhatsApp ‡§µ‡§∞ ‡§∂‡•á‡§Ö‡§∞
  </button>
  <button class="btn btn-primary w-100 mb-2" onclick="window.print()">
    üñ®Ô∏è ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü
  </button>
  <a href="/dashboard" class="btn btn-secondary w-100">‚¨Ö ‡§™‡§∞‡§§</a>
</div>

<script>
  function shareToWhatsapp() {
    let card = document.getElementById("vCard");
    html2canvas(card).then((canvas) => {
      canvas.toBlob(async (blob) => {
        const file = new File([blob], "voter_card.png", { type: "image/png" });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({ title: "Voter Card", files: [file] });
        } else {
          const a = document.createElement("a");
          a.href = canvas.toDataURL();
          a.download = "voter_card.png";
          a.click();
          alert("Saved ‚Äî now share manually.");
        }
      });
    });
  }
</script>

{% endblock %}
