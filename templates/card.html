{% extends "base.html" %} {% block content %}

<!-- html2canvas for screenshot -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  /* Hide buttons during print */
  @media print {
    .no-print {
      display: none !important;
    }

    body * {
      visibility: hidden;
    }

    #voterCard,
    #voterCard * {
      visibility: visible;
    }

    #voterCard {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
  }
</style>

<div class="container mt-3" id="voterCard">
  <div class="card shadow p-4" style="max-width: 550px; margin: auto">
    <h4 class="text-primary mb-3 fw-bold text-center">‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§ì‡§≥‡§ñ‡§™‡§§‡•ç‡§∞</h4>

    <!-- Voter Photo -->
    <div class="text-center mb-3">
      <img
        src="/{{ v.photo }}"
        class="img-thumbnail"
        width="160"
        height="180"
      />
    </div>

    <table class="table table-bordered">
      <tr>
        <th>‡§®‡§æ‡§µ</th>
        <td>{{ v.name }}</td>
      </tr>
      <tr>
        <th>‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
        <td>{{ v.voter_serial }}</td>
      </tr>
      <tr>
        <th>Voter ID</th>
        <td>{{ v.voter_id }}</td>
      </tr>
      <tr>
        <th>‡§µ‡§Ø</th>
        <td>{{ v.age }}</td>
      </tr>
      <tr>
        <th>‡§≤‡§ø‡§Ç‡§ó</th>
        <td>{{ v.gender }}</td>
      </tr>
      <tr>
        <th>‡§ú‡§æ‡§§</th>
        <td>{{ v.caste }}</td>
      </tr>
      <tr>
        <th>‡§™‡§§‡•ç‡§§‡§æ</th>
        <td>{{ v.address }}</td>
      </tr>
      <tr>
        <th>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th>
        <td>{{ v.mobile }}</td>
      </tr>
      <tr>
        <th>‡§®‡§æ‡§§‡•á‡§µ‡§æ‡§à‡§ï</th>
        <td>{{ v.relative_name }}</td>
      </tr>
    </table>
  </div>
</div>

<!-- Buttons -->
<div class="container mt-2 no-print">
  <button class="btn btn-success w-100 mb-2" onclick="shareToWhatsapp()">
    üì≤ WhatsApp ‡§µ‡§∞ ‡§∂‡•á‡§Ö‡§∞ ‡§ï‡§∞‡§æ
  </button>
  <!--
  <button class="btn btn-primary w-100 mb-2" onclick="window.print()">
    üñ®Ô∏è ‡§ï‡§æ‡§∞‡•ç‡§° ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§æ
  </button>
-->
  <a href="/dashboard" class="btn btn-secondary w-100">‚¨ÖÔ∏è ‡§™‡§∞‡§§</a>
</div>

<!-- Screenshot + WhatsApp JS -->
<script>
  function shareToWhatsapp() {
    let card = document.getElementById("voterCard");

    html2canvas(card).then((canvas) => {
      canvas.toBlob(async (blob) => {
        const file = new File([blob], "voter_card.png", { type: "image/png" });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          try {
            await navigator.share({
              title: "Voter Card",
              text: "‡§Æ‡§§‡§¶‡§æ‡§∞ ‡§ì‡§≥‡§ñ‡§™‡§§‡•ç‡§∞",
              files: [file],
            });
          } catch (err) {
            console.log("Share cancelled:", err);
          }
        } else {
          const link = document.createElement("a");
          link.href = canvas.toDataURL("image/png");
          link.download = "voter_card.png";
          link.click();
          alert("‚ö†Ô∏è Sharing not supported.\nImage downloaded, share manually.");
        }
      }, "image/png");
    });
  }
</script>

{% endblock %}
